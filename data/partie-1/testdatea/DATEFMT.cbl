000100 IDENTIFICATION DIVISION.
000200 PROGRAM-ID. DATEFMT.
000300
000700********************************************************
000800 DATA DIVISION.
000900 WORKING-STORAGE SECTION.
000922
000923* MONTH NAMES TABLE
000924 01 MONTH-TABLE.
000925    05 MONTH-ENTRY OCCURS 12 TIMES PIC X(9).
000926
000927* DAY NAMES TABLE
000928 01 DAY-TABLE.
000929    05 DAY-ENTRY OCCURS 7 TIMES PIC X(9).
000930
000931* WORKING VARIABLES
000932 77 WS-YEAR      PIC 9(4).
000933 77 WS-MONTH     PIC 9(2).
000934 77 WS-DAY       PIC 9(2).
000935 77 WS-DOW-NUM   PIC 9.
000936 77 WS-TXT-DATE  PIC X(40).
000937 77 WS-YEAR-ADJ  PIC 9(4).
000938 77 WS-MONTH-ADJ PIC 9(2).
000939 77 WS-TEMP      PIC 9(8).
001070
001100 LINKAGE SECTION.
001110 77 LS-DATE-IN  PIC X(8).
001200 77 LS-DATE-OUT PIC X(40).
001300
001400********************************************************
001500 PROCEDURE DIVISION USING LS-DATE-IN LS-DATE-OUT.
001501
001502* INITIALIZE MONTH NAMES
001503     MOVE 'JANUARY  ' TO MONTH-ENTRY(1)
001504     MOVE 'FEBRUARY ' TO MONTH-ENTRY(2)
001505     MOVE 'MARCH    ' TO MONTH-ENTRY(3)
001506     MOVE 'APRIL    ' TO MONTH-ENTRY(4)
001507     MOVE 'MAY      ' TO MONTH-ENTRY(5)
001508     MOVE 'JUNE     ' TO MONTH-ENTRY(6)
001509     MOVE 'JULY     ' TO MONTH-ENTRY(7)
001510     MOVE 'AUGUST   ' TO MONTH-ENTRY(8)
001511     MOVE 'SEPTEMBER' TO MONTH-ENTRY(9)
001512     MOVE 'OCTOBER  ' TO MONTH-ENTRY(10)
001513     MOVE 'NOVEMBER ' TO MONTH-ENTRY(11)
001514     MOVE 'DECEMBER ' TO MONTH-ENTRY(12)
001515
001520* INITIALIZE DAY NAMES (1=SUNDAY)
001530     MOVE 'SUNDAY   ' TO DAY-ENTRY(1)
001540     MOVE 'MONDAY   ' TO DAY-ENTRY(2)
001550     MOVE 'TUESDAY  ' TO DAY-ENTRY(3)
001560     MOVE 'WEDNESDAY' TO DAY-ENTRY(4)
001570     MOVE 'THURSDAY ' TO DAY-ENTRY(5)
001580     MOVE 'FRIDAY   ' TO DAY-ENTRY(6)
001590     MOVE 'SATURDAY ' TO DAY-ENTRY(7)
001600
001601* USE CURRENT DATE IF INPUT IS EMPTY
001610     IF LS-DATE-IN = SPACES OR LS-DATE-IN = '00000000'
001611        ACCEPT WS-TEMP FROM DATE YYYYMMDD
001612        MOVE WS-TEMP TO LS-DATE-IN
001651     END-IF
001652
001653* EXTRACT YEAR, MONTH, DAY
001654     MOVE LS-DATE-IN(1:4) TO WS-YEAR
001655     MOVE LS-DATE-IN(5:2) TO WS-MONTH
001660     MOVE LS-DATE-IN(7:2) TO WS-DAY
001670
001680* CALCULATE DAY OF WEEK USING ZELLER'S CONGRUENCE
001690     MOVE WS-YEAR TO WS-YEAR-ADJ
001700     MOVE WS-MONTH TO WS-MONTH-ADJ
001800     IF WS-MONTH-ADJ <= 2
001810        SUBTRACT 1 FROM WS-YEAR-ADJ
001820        ADD 12 TO WS-MONTH-ADJ
001830     END-IF
001840
001881     COMPUTE WS-TEMP =
001885       WS-DAY + (13 * (WS-MONTH-ADJ + 1) / 5)
001886        + WS-YEAR-ADJ + (WS-YEAR-ADJ / 4) - (WS-YEAR-ADJ / 100)
001887        + (WS-YEAR-ADJ / 400)
001888     DIVIDE WS-TEMP BY 7 GIVING WS-YEAR-ADJ REMAINDER WS-DOW-NUM
001890
001891*    CONVERT TO OUR FORMAT (1=SUNDAY)
001900     IF WS-DOW-NUM = 0
001901        MOVE 7 TO WS-DOW-NUM
001902     END-IF
001904
001905* BUILD FORMATTED STRING
001906     INITIALIZE WS-TXT-DATE
001907     MOVE DAY-ENTRY(WS-DOW-NUM) TO WS-TXT-DATE(1:9)
001908     MOVE ', '                  TO WS-TXT-DATE(10:2)
001909     MOVE MONTH-ENTRY(WS-MONTH) TO WS-TXT-DATE(12:9)
001910     MOVE ' '                   TO WS-TXT-DATE(21:1)
001911     MOVE WS-DAY                TO WS-TXT-DATE(22:2)
001912     MOVE ', '                  TO WS-TXT-DATE(24:2)
001920     MOVE WS-YEAR               TO WS-TXT-DATE(26:4)
001930
001980     MOVE WS-TXT-DATE TO LS-DATE-OUT
001991
002000     GOBACK.
