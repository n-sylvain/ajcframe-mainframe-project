000100 IDENTIFICATION DIVISION.
000200 PROGRAM-ID. INTEGTEST.
000300
000400 ENVIRONMENT DIVISION.
000500 CONFIGURATION SECTION.
000600 SPECIAL-NAMES.
000700     DECIMAL-POINT IS COMMA.
000800
000900 INPUT-OUTPUT SECTION.
001000 FILE-CONTROL.
001100     SELECT FACTURE-FILE ASSIGN TO FACTURES
001200     ORGANIZATION IS SEQUENTIAL
001300     ACCESS MODE IS SEQUENTIAL
001400     FILE STATUS IS WS-FACTURE-STATUS.
001500
001600 DATA DIVISION.
001700 FILE SECTION.
001800 FD  FACTURE-FILE
001900     RECORDING MODE IS F
002000     RECORD CONTAINS 132 CHARACTERS.
002100 01  FACTURE-RECORD           PIC X(132).
002200
002300 WORKING-STORAGE SECTION.
002400 77 WS-FACTURE-STATUS         PIC XX.
002500 77 WS-EOF-FLAG               PIC X VALUE 'N'.
002600     88 EOF-FACTURE           VALUE 'Y'.
002700
002800* VARIABLES DE TEST
002900 01 LIB                       PIC X(30).
003000 01 L-SEP                     PIC X(50) VALUE ALL '*'.
003100
003200* VARIABLES POUR ANALYSER LE CONTENU COMPLET
003300 77 WS-ABC-COMPANY-FOUND      PIC X VALUE 'N'.
003400     88 ABC-COMPANY-FOUND     VALUE 'Y'.
003500 77 WS-XYZ-COMPANY-FOUND      PIC X VALUE 'N'.
003600     88 XYZ-COMPANY-FOUND     VALUE 'Y'.
003700 77 WS-LMN-COMPANY-FOUND      PIC X VALUE 'N'.
003800     88 LMN-COMPANY-FOUND     VALUE 'Y'.
003900
004000 77 WS-MOUSE-FOUND            PIC X VALUE 'N'.
004100     88 MOUSE-FOUND           VALUE 'Y'.
004200 77 WS-ROUTER-FOUND           PIC X VALUE 'N'.
004300     88 ROUTER-FOUND          VALUE 'Y'.
004400 77 WS-HDD-FOUND              PIC X VALUE 'N'.
004500     88 HDD-FOUND             VALUE 'Y'.
004600
004700 77 WS-DATE-FOUND             PIC X VALUE 'N'.
004800     88 DATE-FOUND            VALUE 'Y'.
004900
005000 LINKAGE SECTION.
005100 COPY TESTCONT.
005200
005300 PROCEDURE DIVISION USING TEST-CONTEXT.
005400
005500     DISPLAY "=== TEST D'INTEGRATION COMPLET ==="
005600     PERFORM TEST-COMPLETE-WORKFLOW
005700     PERFORM TEST-ALL-COMPANIES-PRESENT
005800     PERFORM TEST-ALL-PRODUCTS-PRESENT
005900     PERFORM TEST-DATE-FORMATTING
006000
006100     DISPLAY "=== RESUME INTEGRATION ==="
006200     DISPLAY 'TESTS: ' TESTS-RUN ' OK: ' PASSES ' KO: ' FAILURES
006300     DISPLAY L-SEP
006400
006500     GOBACK.
006600
006700 TEST-COMPLETE-WORKFLOW.
006800     MOVE 'TEST-COMPLETE-WORKFLOW' TO LIB
006900     ADD 1 TO TESTS-RUN
007000
007100* VERIFICATION QUE LE FICHIER DE FACTURES EXISTE ET CONTIENT DES DONNEES
007200     OPEN INPUT FACTURE-FILE
007300     IF WS-FACTURE-STATUS NOT = '00'
007400         ADD 1 TO FAILURES
007500         DISPLAY 'FAILED : ' LIB
007600         DISPLAY 'WORKFLOW INCOMPLET - PAS DE FACTURES'
007700         GO TO TEST-COMPLETE-WORKFLOW-EXIT
007800     END-IF
007900
008000     READ FACTURE-FILE
008100         AT END
008200             ADD 1 TO FAILURES
008300             DISPLAY 'FAILED : ' LIB
008400             DISPLAY 'FICHIER FACTURES VIDE'
008500             GO TO TEST-COMPLETE-WORKFLOW-CLOSE
008600         NOT AT END
008700             ADD 1 TO PASSES
008800             DISPLAY '******** ' LIB ' - PASSED *********'
008900             DISPLAY 'WORKFLOW COMPLET OK'
009000     END-READ
009100
009200 TEST-COMPLETE-WORKFLOW-CLOSE.
009300     CLOSE FACTURE-FILE
009400 TEST-COMPLETE-WORKFLOW-EXIT.
009500     DISPLAY L-SEP.
009600
009700 TEST-ALL-COMPANIES-PRESENT.
009800     MOVE 'TEST-ALL-COMPANIES-PRESENT' TO LIB
009900     ADD 1 TO TESTS-RUN
010000
010100     OPEN INPUT FACTURE-FILE
010200     IF WS-FACTURE-STATUS NOT = '00'
010300         ADD 1 TO FAILURES
010400         DISPLAY 'FAILED : ' LIB
010500         DISPLAY 'IMPOSSIBLE D OUVRIR LE FICHIER'
010600         GO TO TEST-ALL-COMPANIES-EXIT
010700     END-IF
010800
010900     MOVE 'N' TO WS-EOF-FLAG
011000
011100     PERFORM UNTIL EOF-FACTURE
011200         READ FACTURE-FILE
011300             AT END
011400                 SET EOF-FACTURE TO TRUE
011500             NOT AT END
011600* RECHERCHE DES TROIS COMPANIES
011700                 IF FACTURE-RECORD(86:11) = 'ABC Company'
011800                     SET ABC-COMPANY-FOUND TO TRUE
011900                 END-IF
012000                 IF FACTURE-RECORD(86:15) = 'XYZ Corporation'
012100                     SET XYZ-COMPANY-FOUND TO TRUE
012200                 END-IF
012300                 IF FACTURE-RECORD(86:15) = 'LMN Enterprises'
012400                     SET LMN-COMPANY-FOUND TO TRUE
012500                 END-IF
012600         END-READ
012700     END-PERFORM
012800
012900     IF ABC-COMPANY-FOUND AND XYZ-COMPANY-FOUND AND LMN-COMPANY-FOUND
013000         ADD 1 TO PASSES
013100         DISPLAY '******** ' LIB ' - PASSED *********'
013200         DISPLAY 'TOUTES LES COMPANIES TROUVEES'
013300     ELSE
013400         ADD 1 TO FAILURES
013500         DISPLAY 'FAILED : ' LIB
013600         IF NOT ABC-COMPANY-FOUND
013700             DISPLAY 'ABC COMPANY MANQUANTE'
013800         END-IF
013900         IF NOT XYZ-COMPANY-FOUND
014000             DISPLAY 'XYZ CORPORATION MANQUANTE'
014100         END-IF
014200         IF NOT LMN-COMPANY-FOUND
014300             DISPLAY 'LMN ENTERPRISES MANQUANTE'
014400         END-IF
014500     END-IF
014600
014700     CLOSE FACTURE-FILE
014800 TEST-ALL-COMPANIES-EXIT.
014900     DISPLAY L-SEP.
015000
015100 TEST-ALL-PRODUCTS-PRESENT.
015200     MOVE 'TEST-ALL-PRODUCTS-PRESENT' TO LIB
015300     ADD 1 TO TESTS-RUN
015400
015500     OPEN INPUT FACTURE-FILE
015600     IF WS-FACTURE-STATUS NOT = '00'
015700         ADD 1 TO FAILURES
015800         DISPLAY 'FAILED : ' LIB
015900         DISPLAY 'IMPOSSIBLE D OUVRIR LE FICHIER'
016000         GO TO TEST-ALL-PRODUCTS-EXIT
016100     END-IF
016200
016300     MOVE 'N' TO WS-EOF-FLAG
016400
016500     PERFORM UNTIL EOF-FACTURE
016600         READ FACTURE-FILE
016700             AT END
016800                 SET EOF-FACTURE TO TRUE
016900             NOT AT END
017000* RECHERCHE DES PRODUITS
017100                 IF FACTURE-RECORD(7:15) = 'Mouse Bluetooth'
017200                     SET MOUSE-FOUND TO TRUE
017300                 END-IF
017400                 IF FACTURE-RECORD(7:6) = 'Router'
017500                     SET ROUTER-FOUND TO TRUE
017600                 END-IF
017700                 IF FACTURE-RECORD(7:19) = 'External Hard Drive'
017800                     SET HDD-FOUND TO TRUE
017900                 END-IF
018000         END-READ
018100     END-PERFORM
018200
018300     IF MOUSE-FOUND AND ROUTER-FOUND AND HDD-FOUND
018400         ADD 1 TO PASSES
018500         DISPLAY '******** ' LIB ' - PASSED *********'
018600         DISPLAY 'TOUS LES PRODUITS TROUVES'
018700     ELSE
018800         ADD 1 TO FAILURES
018900         DISPLAY 'FAILED : ' LIB
019000         IF NOT MOUSE-FOUND
019100             DISPLAY 'MOUSE BLUETOOTH MANQUANT'
019200         END-IF
019300         IF NOT ROUTER-FOUND
019400             DISPLAY 'ROUTER MANQUANT'
019500         END-IF
019600         IF NOT HDD-FOUND
019700             DISPLAY 'EXTERNAL HARD DRIVE MANQUANT'
019800         END-IF
019900     END-IF
020000
020100     CLOSE FACTURE-FILE
020200 TEST-ALL-PRODUCTS-EXIT.
020300     DISPLAY L-SEP.
020400
020500 TEST-DATE-FORMATTING.
020600     MOVE 'TEST-DATE-FORMATTING' TO LIB
020700     ADD 1 TO TESTS-RUN
020800
020900     OPEN INPUT FACTURE-FILE
021000     IF WS-FACTURE-STATUS NOT = '00'
021100         ADD 1 TO FAILURES
021200         DISPLAY 'FAILED : ' LIB
021300         DISPLAY 'IMPOSSIBLE D OUVRIR LE FICHIER'
021400         GO TO TEST-DATE-FORMATTING-EXIT
021500     END-IF
021600
021700     MOVE 'N' TO WS-EOF-FLAG
021800
021900     PERFORM UNTIL EOF-FACTURE
022000         READ FACTURE-FILE
022100             AT END
022200                 SET EOF-FACTURE TO TRUE
022300             NOT AT END
022400* RECHERCHE D'UNE DATE FORMATEE (FORMAT: "New York, JOUR, MOIS DD, YYYY")
022500                 IF FACTURE-RECORD(5:8) = 'New York' AND
022600                    FACTURE-RECORD(13:1) = ',' AND
022700                    FACTURE-RECORD(15:1) NOT = SPACE
022800                     SET DATE-FOUND TO TRUE
022900                 END-IF
023000         END-READ
023100     END-PERFORM
023200
023300     IF DATE-FOUND
023400         ADD 1 TO PASSES
023500         DISPLAY '******** ' LIB ' - PASSED *********'
023600         DISPLAY 'FORMATAGE DATE OK'
023700     ELSE
023800         ADD 1 TO FAILURES
023900         DISPLAY 'FAILED : ' LIB
024000         DISPLAY 'AUCUNE DATE FORMATEE TROUVEE'
024100     END-IF
024200
024300     CLOSE FACTURE-FILE
024400 TEST-DATE-FORMATTING-EXIT.
024500     DISPLAY L-SEP.