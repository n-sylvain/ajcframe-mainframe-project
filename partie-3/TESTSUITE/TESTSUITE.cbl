000100 IDENTIFICATION DIVISION.
000200 PROGRAM-ID. TESTSUITE.
000300
000400 ENVIRONMENT DIVISION.
000500 CONFIGURATION SECTION.
000600 SPECIAL-NAMES.
000700     DECIMAL-POINT IS COMMA.
000800
000900 DATA DIVISION.
001000 WORKING-STORAGE SECTION.
001100
001200 01  TOTAL-CONTEXT.
001300     05 TOTAL-TESTS-RUN       PIC 9(3) VALUE ZERO.
001400     05 TOTAL-PASSES          PIC 9(3) VALUE ZERO.
001500     05 TOTAL-FAILURES        PIC 9(3) VALUE ZERO.
001600
001700 01  L-SEP                    PIC X(60) VALUE ALL '='.
001800 01  L-HEADER                 PIC X(60) VALUE
001900     '=================== SUITE DE TESTS COBOL ================='.
002000 01  L-FOOTER                 PIC X(60) VALUE
002100     '=================== FIN DES TESTS ====================='.
002200
002300 LINKAGE SECTION.
002400 COPY TESTCONT.
002500
002600 PROCEDURE DIVISION USING TEST-CONTEXT.
002700
002800     DISPLAY L-HEADER
002900
003000* INITIALISATION DES COMPTEURS GLOBAUX
003100     MOVE ZERO TO TOTAL-TESTS-RUN
003200     MOVE ZERO TO TOTAL-PASSES  
003300     MOVE ZERO TO TOTAL-FAILURES
003400
003500* TEST 1: PROGRAMME DATEFMT
003600     DISPLAY ' '
003700     DISPLAY '*** TEST DU PROGRAMME DATEFMT ***'
003800     MOVE ZERO TO TESTS-RUN
003900     MOVE ZERO TO PASSES
004000     MOVE ZERO TO FAILURES
004100
004200     CALL 'DATETEST' USING BY REFERENCE TEST-CONTEXT
004300
004400     ADD TESTS-RUN TO TOTAL-TESTS-RUN
004500     ADD PASSES TO TOTAL-PASSES
004600     ADD FAILURES TO TOTAL-FAILURES
004700
004800     DISPLAY 'DATEFMT - TESTS: ' TESTS-RUN 
004900             ' OK: ' PASSES ' KO: ' FAILURES
005000
005100* TEST 2: PROGRAMME EXTRACT
005200     DISPLAY ' '
005300     DISPLAY '*** TEST DU PROGRAMME EXTRACT ***'
005400     MOVE ZERO TO TESTS-RUN
005500     MOVE ZERO TO PASSES
005600     MOVE ZERO TO FAILURES
005700
005800     CALL 'EXTRACTTEST' USING BY REFERENCE TEST-CONTEXT
005900
006000     ADD TESTS-RUN TO TOTAL-TESTS-RUN
006100     ADD PASSES TO TOTAL-PASSES
006200     ADD FAILURES TO TOTAL-FAILURES
006300
006400     DISPLAY 'EXTRACT - TESTS: ' TESTS-RUN 
006500             ' OK: ' PASSES ' KO: ' FAILURES
006600
006700* TEST 3: PROGRAMME FACTURE
006800     DISPLAY ' '
006900     DISPLAY '*** TEST DU PROGRAMME FACTURE ***'
007000     MOVE ZERO TO TESTS-RUN
007100     MOVE ZERO TO PASSES
007200     MOVE ZERO TO FAILURES
007300
007400     CALL 'FACTURETEST' USING BY REFERENCE TEST-CONTEXT
007500
007600     ADD TESTS-RUN TO TOTAL-TESTS-RUN
007700     ADD PASSES TO TOTAL-PASSES
007800     ADD FAILURES TO TOTAL-FAILURES
007900
008000     DISPLAY 'FACTURE - TESTS: ' TESTS-RUN 
008100             ' OK: ' PASSES ' KO: ' FAILURES
008200
008300* RESUME FINAL
008400     DISPLAY ' '
008500     DISPLAY L-FOOTER
008600     DISPLAY 'RESUME GLOBAL:'
008700     DISPLAY 'TOTAL TESTS   : ' TOTAL-TESTS-RUN
008800     DISPLAY 'TOTAL PASSES  : ' TOTAL-PASSES
008900     DISPLAY 'TOTAL FAILURES: ' TOTAL-FAILURES
009000
009100     IF TOTAL-FAILURES = ZERO
009200         DISPLAY 'STATUT: TOUS LES TESTS SONT PASSES !'
009300         MOVE 0 TO RETURN-CODE
009400     ELSE
009500         DISPLAY 'STATUT: CERTAINS TESTS ONT ECHOUE'
009600         MOVE 8 TO RETURN-CODE
009700     END-IF
009800
009900     DISPLAY L-SEP
010000
010100     GOBACK.