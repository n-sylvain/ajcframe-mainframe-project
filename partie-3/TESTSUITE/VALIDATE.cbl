000100 IDENTIFICATION DIVISION.
000200 PROGRAM-ID. VALIDATE.
000300
000400 ENVIRONMENT DIVISION.
000500 CONFIGURATION SECTION.
000600 SPECIAL-NAMES.
000700     DECIMAL-POINT IS COMMA.
000800
000900 INPUT-OUTPUT SECTION.
001000 FILE-CONTROL.
001100     SELECT EXTRACT-FILE ASSIGN TO EXTRACT
001200     ORGANIZATION IS SEQUENTIAL
001300     ACCESS MODE IS SEQUENTIAL
001400     FILE STATUS IS WS-EXTRACT-STATUS.
001500
001600 DATA DIVISION.
001700 FILE SECTION.
001800 FD  EXTRACT-FILE
001900     RECORDING MODE IS F
002000     RECORD CONTAINS 280 CHARACTERS.
002100 01  EXTRACT-RECORD           PIC X(280).
002200
002300 WORKING-STORAGE SECTION.
002400 77 WS-EXTRACT-STATUS         PIC XX.
002500 77 WS-VALIDATION-COUNT       PIC 9 VALUE ZERO.
002600 77 WS-ERROR-COUNT            PIC 9 VALUE ZERO.
002700
002800* MESSAGES DE VALIDATION
002900 01 L-SEP                     PIC X(50) VALUE ALL '='.
003000 01 L-HEADER                  PIC X(50) VALUE
003100     '=============== VALIDATION ENVIRONNEMENT ========='.
003200
003300 PROCEDURE DIVISION.
003400
003500     DISPLAY L-HEADER
003600     DISPLAY 'VERIFICATION DE L ENVIRONNEMENT DE TEST...'
003700     DISPLAY ' '
003800
003900* VALIDATION 1: FICHIER EXTRACT ACCESSIBLE
004000     ADD 1 TO WS-VALIDATION-COUNT
004100     OPEN INPUT EXTRACT-FILE
004200     IF WS-EXTRACT-STATUS = '00'
004300         DISPLAY 'OK  - FICHIER EXTRACT ACCESSIBLE'
004400         CLOSE EXTRACT-FILE
004500     ELSE
004600         DISPLAY 'KO  - FICHIER EXTRACT INACCESSIBLE (STATUS: '
004700                 WS-EXTRACT-STATUS ')'
004800         DISPLAY '     VERIFIEZ QUE EXTRACT A ETE EXECUTE'
004900         ADD 1 TO WS-ERROR-COUNT
005000     END-IF
005100
005200* VALIDATION 2: TEST D'APPEL DATEFMT
005300     ADD 1 TO WS-VALIDATION-COUNT
005400     PERFORM TEST-DATEFMT-CALL
005500
005600* VALIDATION 3: PROGRAMMES COMPILES
005700     ADD 1 TO WS-VALIDATION-COUNT
005800     PERFORM TEST-PROGRAM-AVAILABILITY
005900
006000* RESUME DE VALIDATION
006100     DISPLAY ' '
006200     DISPLAY 'RESUME VALIDATION:'
006300     DISPLAY 'VERIFICATIONS: ' WS-VALIDATION-COUNT
006400     DISPLAY 'ERREURS      : ' WS-ERROR-COUNT
006500
006600     IF WS-ERROR-COUNT = ZERO
006700         DISPLAY 'ENVIRONNEMENT PRET POUR LES TESTS'
006800         MOVE 0 TO RETURN-CODE
006900     ELSE
007000         DISPLAY 'ENVIRONNEMENT NON PRET - CORRIGER LES ERREURS'
007100         MOVE 8 TO RETURN-CODE
007200     END-IF
007300
007400     DISPLAY L-SEP
007500     GOBACK.
007600
007700 TEST-DATEFMT-CALL.
007800* VARIABLES LOCALES POUR LE TEST
007900     01 TEST-DATE-IN       PIC X(8) VALUE '20250826'.
008000     01 TEST-DATE-OUT      PIC X(40).
008100
008200     CALL 'DATEFMT' USING BY REFERENCE TEST-DATE-IN
008300                          BY REFERENCE TEST-DATE-OUT
008400     ON EXCEPTION
008500         DISPLAY 'KO  - DATEFMT NON DISPONIBLE'
008600         DISPLAY '     VERIFIEZ LA COMPILATION DE DATEFMT'
008700         ADD 1 TO WS-ERROR-COUNT
008800     NOT ON EXCEPTION
008900         IF TEST-DATE-OUT NOT = SPACES
009000             DISPLAY 'OK  - DATEFMT FONCTIONNE: ' TEST-DATE-OUT(1:30)
009100         ELSE
009200             DISPLAY 'KO  - DATEFMT NE FORMATE PAS CORRECTEMENT'
009300             ADD 1 TO WS-ERROR-COUNT
009400         END-IF
009500     END-CALL.
009600
009700 TEST-PROGRAM-AVAILABILITY.
009800* TENTATIVE D'APPEL A FACTURE (SANS PARAMETRES POUR EVITER ERREURS)
009900     CALL 'FACTURE'
010000     ON EXCEPTION
010100         DISPLAY 'KO  - PROGRAMME FACTURE NON DISPONIBLE'
010200         DISPLAY '     VERIFIEZ LA COMPILATION DE FACTURE'
010300         ADD 1 TO WS-ERROR-COUNT
010400     NOT ON EXCEPTION
010500         DISPLAY 'OK  - PROGRAMME FACTURE DISPONIBLE'
010600     END-CALL.