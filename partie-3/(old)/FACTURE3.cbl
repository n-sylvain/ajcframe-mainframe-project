000100 IDENTIFICATION DIVISION.
000200 PROGRAM-ID. FACTURE.
000300
000400* GENERATION DES FACTURES A PARTIR DES DONNEES EXTRAITES
000500 ENVIRONMENT DIVISION.
000600 CONFIGURATION SECTION.
000700 SPECIAL-NAMES.
000800     DECIMAL-POINT IS COMMA.
000900
001000 INPUT-OUTPUT SECTION.
001100 FILE-CONTROL.
001200     SELECT EXTRACT-FILE ASSIGN TO EXTRACT
001300     ORGANIZATION IS SEQUENTIAL
001400     ACCESS MODE IS SEQUENTIAL
001500     FILE STATUS IS WS-EXTRACT-STATUS.
001600
001700     SELECT FACTURE-FILE ASSIGN TO FACTURES
001800     ORGANIZATION IS SEQUENTIAL
001900     ACCESS MODE IS SEQUENTIAL
002000     FILE STATUS IS WS-FACTURE-STATUS.
002100
002200 DATA DIVISION.
002300 FILE SECTION.
002400 FD  EXTRACT-FILE
002500     RECORDING MODE IS F
002600     RECORD CONTAINS 280 CHARACTERS.
002700 01  EXTRACT-RECORD.
002800     05 EXT-COMPANY           PIC X(30).
002900     05 EXT-ADDRESS           PIC X(100).
003000     05 EXT-CITY              PIC X(20).
003100     05 EXT-ZIP               PIC X(5).
003200     05 EXT-STATE             PIC X(2).
003300     05 EXT-O-NO              PIC 9(3).
003400     05 EXT-ODATE-ISO         PIC X(10).
003500     05 EXT-DNAME             PIC X(20).
003600     05 EXT-LNAME             PIC X(20).
003700     05 EXT-FNAME             PIC X(20).
003800     05 EXT-P-NO              PIC X(3).
003900     05 EXT-DESCRIPTION       PIC X(30).
004000     05 EXT-QUANTITY          PIC 9(2).
004100     05 EXT-PRICE             PIC 9(3).99.
004200     05 EXT-LINE-TOTAL        PIC 9(5).99.
004300     05 FILLER                PIC X(1).
004400
004500 FD  FACTURE-FILE
004600     RECORDING MODE IS F
004700     RECORD CONTAINS 100 CHARACTERS.
004800 01  FACTURE-RECORD           PIC X(100).
004900
005000 WORKING-STORAGE SECTION.
005100* VARIABLES DE CONTROLE DES FICHIERS
005200 77 WS-EXTRACT-STATUS         PIC XX.
005300 77 WS-FACTURE-STATUS         PIC XX.
005400 77 WS-EOF-EXTRACT            PIC X VALUE 'N'.
005500     88 EOF-EXTRACT           VALUE 'Y'.
005600
005700* VARIABLES POUR LA FACTURE EN COURS
005800 77 WS-CURRENT-ORDER          PIC 9(3) VALUE ZERO.
005900 77 WS-ORDER-TOTAL            PIC 9(7)V99 VALUE ZERO.
006000* TVA PAR DEFAUT A 20%
006100 77 WS-TVA-RATE               PIC 9V999 VALUE 0,200.
006200 77 WS-TVA-AMOUNT             PIC 9(7)V99 VALUE ZERO.
006300 77 WS-COMMISSION-RATE        PIC 9V999 VALUE 0,099.
006400 77 WS-COMMISSION-AMOUNT      PIC 9(7)V99 VALUE ZERO.
006500 77 WS-TOTAL-WITH-TAXES       PIC 9(7)V99 VALUE ZERO.
006600
006700* VARIABLES POUR LIRE LE TAUX DE TVA
006800 77 WS-TVA-INPUT              PIC X(10).
006900 77 WS-TVA-NUMERIC            PIC 9(2)V9.
007000 77 WS-ERROR-FLAG             PIC X VALUE 'N'.
007100     88 ERROR-OCCURRED        VALUE 'Y'.
007200 77 WS-TVA-PERCENT            PIC 9(2)V9.
007300
007400* VARIABLES DE TRAVAIL POUR LES CALCULS
007500 77 WS-LINE-TOTAL-WORK        PIC 9(7)V99.
007600 77 WS-PRICE-WORK             PIC 9(5)V99.
007700 77 WS-QUANTITY-WORK          PIC 9(2).
007800
007900* VARIABLES POUR LE FORMATAGE DE LA DATE
008000 77 WS-DATE-IN                PIC X(8) VALUE SPACES.
008100 77 WS-DATE-FORMATEE          PIC X(40).
008200
008300* LIGNES DE SORTIE FORMATEES
008400 01 LIGNE-VIDE                PIC X(132) VALUE SPACES.
008500
008600 01 LIGNE-CADRE-HAUT.
008700     05 FILLER                PIC X(2) VALUE '+-'.
008800     05 FILLER                PIC X(128) VALUE ALL '-'.
008900     05 FILLER                PIC X(2) VALUE '-+'.
009000
009100 01 LIGNE-CADRE-BAS.
009200     05 FILLER                PIC X(2) VALUE '+-'.
009300     05 FILLER                PIC X(128) VALUE ALL '-'.
009400     05 FILLER                PIC X(2) VALUE '-+'.
009500
009600 01 LIGNE-ADRESSE.
009700     05 FILLER                PIC X(2) VALUE '| '.
009800     05 FILLER                PIC X(48) VALUE SPACES.
009900     05 LA-COMPANY            PIC X(30).
010000     05 FILLER                PIC X(50) VALUE SPACES.
010100     05 FILLER                PIC X(2) VALUE ' |'.
010200
010300 01 LIGNE-RUE.
010400     05 FILLER                PIC X(2) VALUE '| '.
010500     05 FILLER                PIC X(48) VALUE SPACES.
010600     05 LA-ADDRESS            PIC X(30).
010700     05 FILLER                PIC X(50) VALUE SPACES.
010800     05 FILLER                PIC X(2) VALUE ' |'.
010900
011000 01 LIGNE-VILLE.
011100     05 FILLER                PIC X(2) VALUE '| '.
011200     05 FILLER                PIC X(48) VALUE SPACES.
011300     05 LA-CITY               PIC X(20).
011400     05 FILLER                PIC X(2) VALUE ', '.
011500     05 LA-ZIP                PIC X(5).
011600     05 FILLER                PIC X(53) VALUE SPACES.
011700     05 FILLER                PIC X(2) VALUE ' |'.
011800
011900 01 LIGNE-STATE.
012000     05 FILLER                PIC X(2) VALUE '| '.
012100     05 FILLER                PIC X(48) VALUE SPACES.
012200     05 LA-STATE              PIC X(2).
012300     05 FILLER                PIC X(78) VALUE SPACES.
012400     05 FILLER                PIC X(2) VALUE ' |'.
012500
012600 01 LIGNE-CADRE-VIDE.
012700     05 FILLER                PIC X(2) VALUE '| '.
012800     05 FILLER                PIC X(128) VALUE SPACES.
012900     05 FILLER                PIC X(2) VALUE ' |'.
013000
013100 01 LIGNE-DATE.
013200     05 FILLER                PIC X(2) VALUE '| '.
013300     05 FILLER                PIC X(3) VALUE SPACES.
013400     05 LD-VILLE              PIC X(8) VALUE 'New York'.
013500     05 FILLER                PIC X(2) VALUE ', '.
013600     05 LD-DATE-FORMATEE      PIC X(40).
013700     05 FILLER                PIC X(53) VALUE SPACES.
013800     05 FILLER                PIC X(2) VALUE ' |'.
013900
014000 01 LIGNE-ORDER.
014100     05 FILLER                PIC X(2) VALUE '| '.
014200     05 FILLER                PIC X(3) VALUE SPACES.
014300     05 FILLER                PIC X(16) VALUE 'Order Number : '.
014400     05 LO-ORDER-NO           PIC 999.
014500     05 FILLER                PIC X(106) VALUE SPACES.
014600     05 FILLER                PIC X(2) VALUE ' |'.
014700
014800 01 LIGNE-ORDER-DATE.
014900     05 FILLER                PIC X(2) VALUE '| '.
015000     05 FILLER                PIC X(3) VALUE SPACES.
015100     05 FILLER                PIC X(14) VALUE 'Order Date : '.
015200     05 LOD-ORDER-DATE        PIC X(10).
015300     05 FILLER                PIC X(101) VALUE SPACES.
015400     05 FILLER                PIC X(2) VALUE ' |'.
015500
015600 01 LIGNE-CONTACT.
015700     05 FILLER                PIC X(2) VALUE '| '.
015800     05 FILLER                PIC X(3) VALUE SPACES.
015900     05 FILLER                PIC X(35) VALUE
016000                          'Your contact within the department '.
016100     05 LC-DNAME              PIC X(20).
016200     05 FILLER                PIC X(3) VALUE ' : '.
016300     05 LC-LNAME              PIC X(20).
016400     05 FILLER                PIC X(2) VALUE ', '.
016500     05 LC-FNAME              PIC X(20).
016600     05 FILLER                PIC X(25) VALUE SPACES.
016700     05 FILLER                PIC X(2) VALUE ' |'.
016800
016900 01 LIGNE-HEADER-CADRE.
017000     05 FILLER                PIC X(2) VALUE '| '.
017100     05 FILLER                PIC X(3) VALUE SPACES.
017200     05 FILLER                PIC X(50) VALUE ALL '-'.
017300     05 FILLER                PIC X(75) VALUE SPACES.
017400     05 FILLER                PIC X(2) VALUE ' |'.
017500
017600 01 LIGNE-HEADER.
017700     05 FILLER                PIC X(2) VALUE '| '.
017800     05 FILLER                PIC X(3) VALUE SPACES.
017900     05 FILLER                PIC X(2) VALUE '| '.
018000     05 FILLER                PIC X(4) VALUE 'P_NO'.
018100     05 FILLER                PIC X(1) VALUE ' '.
018200     05 FILLER                PIC X(25) VALUE 'DESCRIPTION'.
018300     05 FILLER                PIC X(8) VALUE 'QUANTITY'.
018400     05 FILLER                PIC X(2) VALUE SPACES.
018500     05 FILLER                PIC X(8) VALUE 'PRICE'.
018600     05 FILLER                PIC X(6) VALUE SPACES.
018700     05 FILLER                PIC X(10) VALUE 'LINE TOTAL'.
018800     05 FILLER                PIC X(59) VALUE SPACES.
018900     05 FILLER                PIC X(2) VALUE ' |'.
019000
019100 01 LIGNE-PRODUIT.
019200     05 FILLER                PIC X(2) VALUE '| '.
019300     05 FILLER                PIC X(3) VALUE SPACES.
019400     05 FILLER                PIC X(2) VALUE '| '.
019500     05 LP-P-NO               PIC X(3).
019600     05 FILLER                PIC X(2) VALUE SPACES.
019700     05 LP-DESCRIPTION        PIC X(25).
019800     05 FILLER                PIC X(3) VALUE SPACES.
019900     05 LP-QUANTITY           PIC ZZ9.
020000     05 FILLER                PIC X(5) VALUE SPACES.
020100     05 LP-PRICE              PIC ZZZ,99.
020200     05 FILLER                PIC X(4) VALUE SPACES.
020300     05 LP-LINE-TOTAL         PIC ZZ.ZZZ,99.
020400     05 FILLER                PIC X(59) VALUE SPACES.
020500     05 FILLER                PIC X(2) VALUE ' |'.
020600
020700 01 LIGNE-SOUS-TOTAL.
020800     05 FILLER                PIC X(2) VALUE '| '.
020900     05 FILLER                PIC X(68) VALUE SPACES.
021000     05 FILLER                PIC X(12) VALUE 'SUB TOTAL : '.
021100     05 LST-AMOUNT            PIC ZZ.ZZZ,99.
021200     05 FILLER                PIC X(39) VALUE SPACES.
021300     05 FILLER                PIC X(2) VALUE ' |'.
021400
021500 01 LIGNE-TVA.
021600     05 FILLER                PIC X(2) VALUE '| '.
021700     05 FILLER                PIC X(68) VALUE SPACES.
021800     05 FILLER                PIC X(11) VALUE 'SALES TAX ('.
021900     05 LT-PERCENT            PIC Z9,9.
022000     05 FILLER                PIC X(3) VALUE '%):'.
022100     05 LT-AMOUNT             PIC ZZ.ZZZ,99.
022200     05 FILLER                PIC X(1) VALUE SPACES.
022300     05 FILLER                PIC X(2) VALUE ' |'.
022400
022500 01 LIGNE-COMMISSION.
022600     05 FILLER                PIC X(2) VALUE '| '.
022700     05 FILLER                PIC X(68) VALUE SPACES.
022800     05 FILLER                PIC X(12) VALUE 'COMMISSION: '.
022900     05 LC-AMOUNT             PIC ZZ.ZZZ,99.
023000     05 FILLER                PIC X(39) VALUE SPACES.
023100     05 FILLER                PIC X(2) VALUE ' |'.
023200
023300 01 LIGNE-TOTAL.
023400     05 FILLER                PIC X(2) VALUE '| '.
023500     05 FILLER                PIC X(68) VALUE SPACES.
023600     05 FILLER                PIC X(12) VALUE 'TOTAL     : '.
023700     05 LTO-AMOUNT            PIC ZZ.ZZZ,99.
023800     05 FILLER                PIC X(39) VALUE SPACES.
023900     05 FILLER                PIC X(2) VALUE ' |'.
024000
024100 PROCEDURE DIVISION.
024200
024300     DISPLAY "=== DEBUT GENERATION FACTURES ==="
024400
024500* OBTENIR LA DATE COURANTE FORMATEE
024600     PERFORM OBTENIR-DATE
024700
024800* LECTURE DU TAUX DE TVA DEPUIS SYSIN
024900     PERFORM LIRE-TAUX-TVA
025000
025100* OUVERTURE DES FICHIERS
025200     OPEN INPUT EXTRACT-FILE
025300     IF WS-EXTRACT-STATUS NOT = '00'
025400         DISPLAY "ERREUR OUVERTURE EXTRACT : ", WS-EXTRACT-STATUS
025500         PERFORM ABEND-PROG
025600     END-IF
025700
025800     OPEN OUTPUT FACTURE-FILE
025900     IF WS-FACTURE-STATUS NOT = '00'
026000         DISPLAY "ERREUR OUVERTURE FACTURES : ", WS-FACTURE-STATUS
026100         PERFORM ABEND-PROG
026200     END-IF
026300
026400* LECTURE DU PREMIER ENREGISTREMENT
026500     PERFORM LIRE-EXTRACT
026600
026700* TRAITEMENT PRINCIPAL
026800     PERFORM UNTIL EOF-EXTRACT
026900         PERFORM GENERER-FACTURE
027000     END-PERFORM
027100
027200* FERMETURE DES FICHIERS
027300     CLOSE EXTRACT-FILE
027400     CLOSE FACTURE-FILE
027500
027600     DISPLAY "=== FIN GENERATION FACTURES ==="
027700     GOBACK.
027800
027900 OBTENIR-DATE.
028000     CALL 'DATEFMT' USING BY REFERENCE WS-DATE-IN
028100                          BY REFERENCE WS-DATE-FORMATEE
028200           MOVE 'N' TO WS-ERROR-FLAG
028300     DISPLAY 'Date facture   : ' WS-DATE-FORMATEE
028400     .
028500
028600 LIRE-TAUX-TVA.
028700* LECTURE DU TAUX DE TVA DEPUIS SYSIN
028800     ACCEPT WS-TVA-INPUT FROM SYSIN
028900     DISPLAY "TVA LUE DEPUIS SYSIN: '", WS-TVA-INPUT, "'"
029000
029100* UTILISER FUNCTION NUMVAL POUR CONVERTIR CHAINE EN NUMERIQUE
029200     COMPUTE WS-TVA-NUMERIC = FUNCTION NUMVAL(WS-TVA-INPUT)
029300
029400     IF WS-TVA-NUMERIC > 0
029500* CONVERSION POURCENTAGE VERS DECIMALE
029600         COMPUTE WS-TVA-RATE = WS-TVA-NUMERIC / 100
029700         COMPUTE WS-TVA-PERCENT = WS-TVA-NUMERIC
029800         DISPLAY "TAUX TVA APPLIQUE : ", WS-TVA-NUMERIC, "%"
029900     ELSE
030000         SET ERROR-OCCURRED TO TRUE
030100         DISPLAY "ERREUR: TAUX HORS LIMITES (0-100%)"
030200     END-IF
030300
030400* EN CAS D'ERREUR, UTILISER 20% PAR DEFAUT
030500     IF ERROR-OCCURRED
030600         MOVE 0,200 TO WS-TVA-RATE
030700         MOVE 20 TO WS-TVA-PERCENT
030800         DISPLAY "UTILISATION DU TAUX PAR DEFAUT : 20%"
030900     END-IF
031000
031100     DISPLAY "TAUX TVA FINAL UTILISE : ", WS-TVA-RATE
031200     .
031300
031400 LIRE-EXTRACT.
031500     READ EXTRACT-FILE
031600         AT END
031700             SET EOF-EXTRACT TO TRUE
031800         NOT AT END
031900             CONTINUE
032000     END-READ
032100     .
032200
032300 GENERER-FACTURE.
032400* INITIALISATION POUR UNE NOUVELLE FACTURE
032500     MOVE EXT-O-NO TO WS-CURRENT-ORDER
032600     MOVE ZERO TO WS-ORDER-TOTAL
032700
032800* EN-TETE DE LA FACTURE AVEC CADRE
032900     MOVE LIGNE-CADRE-HAUT TO FACTURE-RECORD
033000     PERFORM ECRIRE-LIGNE-FACTURE
033100
033200     PERFORM ECRIRE-ENTETE-FACTURE
033300
033400* LIGNES DE PRODUITS POUR CETTE COMMANDE
033500     PERFORM UNTIL EOF-EXTRACT OR EXT-O-NO NOT = WS-CURRENT-ORDER
033600         PERFORM ECRIRE-LIGNE-PRODUIT
033700* CONVERSION DU CHAMP EDITE VERS NUMERIQUE POUR LE CALCUL
033800         MOVE EXT-LINE-TOTAL TO WS-LINE-TOTAL-WORK
033900         ADD WS-LINE-TOTAL-WORK TO WS-ORDER-TOTAL
034000         PERFORM LIRE-EXTRACT
034100     END-PERFORM
034200
034300* CALCULS ET TOTAUX
034400     PERFORM CALCULER-TOTAUX
034500     PERFORM ECRIRE-TOTAUX
034600
034700* FERMETURE DU CADRE
034800     MOVE LIGNE-CADRE-BAS TO FACTURE-RECORD
034900     PERFORM ECRIRE-LIGNE-FACTURE
035000
035100* SAUT DE PAGE
035200     PERFORM ECRIRE-SAUT-PAGE
035300     .
035400
035500 ECRIRE-ENTETE-FACTURE.
035600* ADRESSE SOCIETE ENCADREE
035700     MOVE EXT-COMPANY TO LA-COMPANY
035800     MOVE LIGNE-ADRESSE TO FACTURE-RECORD
035900     PERFORM ECRIRE-LIGNE-FACTURE
036000
036100     MOVE EXT-ADDRESS TO LA-ADDRESS
036200     MOVE LIGNE-RUE TO FACTURE-RECORD
036300     PERFORM ECRIRE-LIGNE-FACTURE
036400
036500     MOVE EXT-CITY TO LA-CITY
036600     MOVE EXT-ZIP TO LA-ZIP
036700     MOVE LIGNE-VILLE TO FACTURE-RECORD
036800     PERFORM ECRIRE-LIGNE-FACTURE
036900
037000     MOVE EXT-STATE TO LA-STATE
037100     MOVE LIGNE-STATE TO FACTURE-RECORD
037200     PERFORM ECRIRE-LIGNE-FACTURE
037300
037400     MOVE LIGNE-CADRE-VIDE TO FACTURE-RECORD
037500     PERFORM ECRIRE-LIGNE-FACTURE
037600     MOVE LIGNE-CADRE-VIDE TO FACTURE-RECORD
037700     PERFORM ECRIRE-LIGNE-FACTURE
037800
037900* DATE ET LIEU
038000     MOVE WS-DATE-FORMATEE TO LD-DATE-FORMATEE
038100     MOVE LIGNE-DATE TO FACTURE-RECORD
038200     PERFORM ECRIRE-LIGNE-FACTURE
038300
038400     MOVE LIGNE-CADRE-VIDE TO FACTURE-RECORD
038500     PERFORM ECRIRE-LIGNE-FACTURE
038600
038700* NUMERO DE COMMANDE
038800     MOVE EXT-O-NO TO LO-ORDER-NO
038900     MOVE LIGNE-ORDER TO FACTURE-RECORD
039000     PERFORM ECRIRE-LIGNE-FACTURE
039100
039200* DATE DE COMMANDE
039300     MOVE EXT-ODATE-ISO TO LOD-ORDER-DATE
039400     MOVE LIGNE-ORDER-DATE TO FACTURE-RECORD
039500     PERFORM ECRIRE-LIGNE-FACTURE
039600
039700     MOVE LIGNE-CADRE-VIDE TO FACTURE-RECORD
039800     PERFORM ECRIRE-LIGNE-FACTURE
039900
040000* CONTACT
040100     MOVE EXT-DNAME TO LC-DNAME
040200     MOVE EXT-LNAME TO LC-LNAME
040300     MOVE EXT-FNAME TO LC-FNAME
040400     MOVE LIGNE-CONTACT TO FACTURE-RECORD
040500     PERFORM ECRIRE-LIGNE-FACTURE
040600
040700     MOVE LIGNE-CADRE-VIDE TO FACTURE-RECORD
040800     PERFORM ECRIRE-LIGNE-FACTURE
040900
041000* EN-TETE DU TABLEAU AVEC CADRE INTERNE
041100     MOVE LIGNE-HEADER-CADRE TO FACTURE-RECORD
041200     PERFORM ECRIRE-LIGNE-FACTURE
041300
041400     MOVE LIGNE-HEADER TO FACTURE-RECORD
041500     PERFORM ECRIRE-LIGNE-FACTURE
041600     .
041700
041800 ECRIRE-LIGNE-PRODUIT.
041900     MOVE EXT-P-NO TO LP-P-NO
042000     MOVE EXT-DESCRIPTION TO LP-DESCRIPTION
042100* CONVERSION DES CHAMPS EDITES POUR L'AFFICHAGE
042200     MOVE EXT-QUANTITY TO WS-QUANTITY-WORK
042300     MOVE WS-QUANTITY-WORK TO LP-QUANTITY
042400     MOVE EXT-PRICE TO WS-PRICE-WORK
042500     MOVE WS-PRICE-WORK TO LP-PRICE
042600     MOVE EXT-LINE-TOTAL TO WS-LINE-TOTAL-WORK
042700     MOVE WS-LINE-TOTAL-WORK TO LP-LINE-TOTAL
042800
042900     MOVE LIGNE-PRODUIT TO FACTURE-RECORD
043000     PERFORM ECRIRE-LIGNE-FACTURE
043100     .
043200
043300 CALCULER-TOTAUX.
043400* CALCUL DE LA TVA
043500     COMPUTE WS-TVA-AMOUNT = WS-ORDER-TOTAL * WS-TVA-RATE
043600
043700* CALCUL DE LA COMMISSION
043800     COMPUTE WS-COMMISSION-AMOUNT = WS-ORDER-TOTAL
043900                                            * WS-COMMISSION-RATE
044000
044100* CALCUL DU TOTAL AVEC TAXES
044200     COMPUTE WS-TOTAL-WITH-TAXES = WS-ORDER-TOTAL
044300                          + WS-TVA-AMOUNT + WS-COMMISSION-AMOUNT
044400     .
044500
044600 ECRIRE-TOTAUX.
044700     MOVE LIGNE-HEADER-CADRE TO FACTURE-RECORD
044800     PERFORM ECRIRE-LIGNE-FACTURE
044900
045000     MOVE LIGNE-CADRE-VIDE TO FACTURE-RECORD
045100     PERFORM ECRIRE-LIGNE-FACTURE
045200
045300* SOUS-TOTAL
045400     MOVE WS-ORDER-TOTAL TO LST-AMOUNT
045500     MOVE LIGNE-SOUS-TOTAL TO FACTURE-RECORD
045600     PERFORM ECRIRE-LIGNE-FACTURE
045700
045800* TVA AVEC POURCENTAGE
045900     MOVE WS-TVA-AMOUNT TO LT-AMOUNT
046000     MOVE WS-TVA-PERCENT TO LT-PERCENT
046100     MOVE LIGNE-TVA TO FACTURE-RECORD
046200     PERFORM ECRIRE-LIGNE-FACTURE
046300
046400* COMMISSION
046500     MOVE WS-COMMISSION-AMOUNT TO LC-AMOUNT
046600     MOVE LIGNE-COMMISSION TO FACTURE-RECORD
046700     PERFORM ECRIRE-LIGNE-FACTURE
046800
046900     MOVE LIGNE-CADRE-VIDE TO FACTURE-RECORD
047000     PERFORM ECRIRE-LIGNE-FACTURE
047100
047200* TOTAL
047300     MOVE WS-TOTAL-WITH-TAXES TO LTO-AMOUNT
047400     MOVE LIGNE-TOTAL TO FACTURE-RECORD
047500     PERFORM ECRIRE-LIGNE-FACTURE
047600     .
047700
047800 ECRIRE-LIGNE-FACTURE.
047900     WRITE FACTURE-RECORD
048000     IF WS-FACTURE-STATUS NOT = '00'
048100         DISPLAY "ERREUR ECRITURE FACTURE : ", WS-FACTURE-STATUS
048200         PERFORM ABEND-PROG
048300     END-IF
048400     .
048500
048600 ECRIRE-SAUT-PAGE.
048700* ECRITURE DE QUELQUES LIGNES VIDES POUR SEPARATION
048800     MOVE LIGNE-VIDE TO FACTURE-RECORD
048900     PERFORM ECRIRE-LIGNE-FACTURE
049000     MOVE LIGNE-VIDE TO FACTURE-RECORD
049100     PERFORM ECRIRE-LIGNE-FACTURE
049200     MOVE LIGNE-VIDE TO FACTURE-RECORD
049300     PERFORM ECRIRE-LIGNE-FACTURE
049400     MOVE LIGNE-VIDE TO FACTURE-RECORD
049500     PERFORM ECRIRE-LIGNE-FACTURE
049600     .
049700
049800 ABEND-PROG.
049900     DISPLAY "ARRET ANORMAL DU PROGRAMME"
050000     MOVE 16 TO RETURN-CODE
050100     GOBACK
050200     .