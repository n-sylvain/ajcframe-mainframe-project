flowchart TD
    A[Début MAJDB] --> B[Ouvrir VENTESEU et VENTESAS]
    B --> C[Lire première ligne de chaque fichier]
    C --> D[Comparer les clés de tri]
    
    D --> E{Type de traitement}
    E -->|CLE_VEU < CLE_VAS| F[Traiter ligne Europe uniquement]
    E -->|CLE_VEU > CLE_VAS| G[Traiter ligne Asie uniquement]
    E -->|CLE_VEU = CLE_VAS| H[Traiter Europe ET Asie]
    
    F --> I[TRAITER-DETAIL-VEU]
    G --> J[TRAITER-DETAIL-VAS]
    H --> I
    H --> J
    
    I --> K{Nouvelle commande?}
    J --> L{Nouvelle commande?}
    
    K -->|Oui| M[Créer commande en DB2]
    K -->|Non| N[Continuer avec commande existante]
    L -->|Oui| O[Créer commande en DB2]
    L -->|Non| P[Continuer avec commande existante]
    
    M --> Q[Récupérer/Calculer prix]
    N --> Q
    O --> R[Récupérer/Calculer prix]
    P --> R
    
    Q --> S{Prix fourni?}
    R --> T{Prix fourni?}
    
    S -->|Non| U[SELECT prix FROM PRODUCTS]
    S -->|Oui| V[Prix = PRIX/100]
    T -->|Non| W[SELECT prix FROM PRODUCTS]
    T -->|Oui| X[Prix = PRIX/100]
    
    U --> Y[Calculer CA = QTE × PRIX]
    V --> Y
    W --> Z[Calculer CA = QTE × PRIX]
    X --> Z
    
    Y --> AA[Insérer ITEM en DB2]
    Z --> BB[Insérer ITEM en DB2]
    
    AA --> CC[Gérer CA client Europe]
    BB --> DD[Gérer CA client Asie]
    
    CC --> EE{Changement client?}
    DD --> FF{Changement client?}
    
    EE -->|Oui| GG[UPDATE BALANCE client précédent]
    EE -->|Non| HH[Accumuler CA client]
    FF -->|Oui| II[UPDATE BALANCE client précédent]
    FF -->|Non| JJ[Accumuler CA client]
    
    GG --> HH
    II --> JJ
    
    HH --> KK[Lire ligne suivante]
    JJ --> LL[Lire ligne suivante]
    
    KK --> MM{Fin de fichier?}
    LL --> NN{Fin de fichier?}
    
    MM -->|Non| D
    NN -->|Non| D
    MM -->|Oui| OO[Traitement rupture finale]
    NN -->|Oui| OO
    
    OO --> PP[UPDATE dernier client]
    PP --> QQ[Afficher statistiques]
    QQ --> RR[Fermer fichiers]
    RR --> SS[Fin programme]
    
    style A fill:#e1f5fe
    style SS fill:#c8e6c9
    style M fill:#fff3e0
    style O fill:#fff3e0
    style GG fill:#f3e5f5
    style II fill:#f3e5f5